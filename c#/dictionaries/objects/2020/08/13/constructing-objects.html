<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Constructing a complex dictionary of base and derived class using the same code | Mitesh Shah’s Blog</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Constructing a complex dictionary of base and derived class using the same code" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An interesting problem I encountered while working and an equally interesting solution suggested to me. How to use the same code to create complex data structure of two different classes." />
<meta property="og:description" content="An interesting problem I encountered while working and an equally interesting solution suggested to me. How to use the same code to create complex data structure of two different classes." />
<link rel="canonical" href="https://mitesh1612.github.io/blog/c%23/dictionaries/objects/2020/08/13/constructing-objects.html" />
<meta property="og:url" content="https://mitesh1612.github.io/blog/c%23/dictionaries/objects/2020/08/13/constructing-objects.html" />
<meta property="og:site_name" content="Mitesh Shah’s Blog" />
<meta property="og:image" content="https://mitesh1612.github.io/blog/images/2020-08-13-constructing-objects/hero.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-08-13T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://mitesh1612.github.io/blog/c%23/dictionaries/objects/2020/08/13/constructing-objects.html","@type":"BlogPosting","headline":"Constructing a complex dictionary of base and derived class using the same code","dateModified":"2020-08-13T00:00:00-05:00","datePublished":"2020-08-13T00:00:00-05:00","image":"https://mitesh1612.github.io/blog/images/2020-08-13-constructing-objects/hero.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://mitesh1612.github.io/blog/c%23/dictionaries/objects/2020/08/13/constructing-objects.html"},"description":"An interesting problem I encountered while working and an equally interesting solution suggested to me. How to use the same code to create complex data structure of two different classes.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://mitesh1612.github.io/blog/feed.xml" title="Mitesh Shah's Blog" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','ru5rvky8-dQ8SDLk4O2l_e5lCAAE486e-RNQgPlG7xM','auto');ga('require','displayfeatures');ga('send','pageview');</script>

<link rel="shortcut icon" type="image/x-icon" href="/blog/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">Mitesh Shah&#39;s Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About Me</a><a class="page-link" href="/blog/demo-post.txt">An Example Markdown Post</a><a class="page-link" href="/blog/search/">Search</a><a class="page-link" href="/blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Constructing a complex dictionary of base and derived class using the same code</h1><p class="page-description">An interesting problem I encountered while working and an equally interesting solution suggested to me. How to use the same code to create complex data structure of two different classes.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-08-13T00:00:00-05:00" itemprop="datePublished">
        Aug 13, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      4 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#C#">C#</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#dictionaries">dictionaries</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#objects">objects</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Okay, really complex title aside, I’ll try to explain the problem I had and the interesting way I found to solve it. This may not be the best or the most optimized way, but I really liked this solution and would like to share it.</p>

<p>Also, although I do prefer Python, this post is in C#, since that was the language I encountered this problem in.</p>

<p>So here is the problem. Say we have two C# Classes</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">BaseClass</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">SomeProperties</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">DerivedClass</span> <span class="p">:</span> <span class="n">BaseClass</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">SomeOtherProperties</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>I wanted to construct a Dictionary of these classes like <code class="language-plaintext highlighter-rouge">Dictionary&lt;string, BaseClass&gt;</code> and <code class="language-plaintext highlighter-rouge">Dictionary&lt;string, DerivedClass&gt;</code> at two very different places. The construction of each dictionary element was not that trivial due to the inherent complexity of filling the properties for both the classes. Here is an example of how one of the dictionaries was being created:</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// For the base class</span>
<span class="kt">var</span> <span class="n">map</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">BaseClass</span><span class="p">&gt;();</span>
<span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">someProperty</span> <span class="k">in</span> <span class="n">someList</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">baseElement</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BaseClass</span><span class="p">(</span><span class="n">someProperty</span><span class="p">);</span>
    <span class="n">map</span><span class="p">[</span><span class="n">someProperty</span><span class="p">]</span> <span class="p">=</span> <span class="n">baseElement</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">dependency</span> <span class="k">in</span> <span class="n">dependencyList</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">map</span><span class="p">[</span><span class="n">dependency</span><span class="p">.</span><span class="n">To</span><span class="p">]</span> <span class="p">=</span> <span class="n">map</span><span class="p">[</span><span class="n">dependency</span><span class="p">.</span><span class="n">From</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1">// For the derived class</span>
<span class="kt">var</span> <span class="n">map</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">DerivedClass</span><span class="p">&gt;();</span>
<span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">someProperty</span> <span class="k">in</span> <span class="n">someList</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// someOtherProperty comes from somewhere else</span>
    <span class="kt">var</span> <span class="n">derivedElement</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DerivedClass</span><span class="p">(</span><span class="n">someProperty</span><span class="p">,</span> <span class="n">someOtherProperty</span><span class="p">);</span>
    <span class="n">map</span><span class="p">[</span><span class="n">someProperty</span><span class="p">]</span> <span class="p">=</span> <span class="n">derivedElement</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">dependency</span> <span class="k">in</span> <span class="n">dependencyList</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">map</span><span class="p">[</span><span class="n">dependency</span><span class="p">.</span><span class="n">To</span><span class="p">]</span> <span class="p">=</span> <span class="n">map</span><span class="p">[</span><span class="n">dependency</span><span class="p">.</span><span class="n">From</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As you can see, there is a lot of logic repeating since the properties that were created for the base class were also created for the derived class, but when we create the DerivedClass object, new properties were also to be added to those object. Both the objects differ in how they are constructed but the way the map is created is similar. I wanted a way to reuse these for loops instead of writing them for both <code class="language-plaintext highlighter-rouge">BaseClass</code> and <code class="language-plaintext highlighter-rouge">DerivedClass</code> and other classes that might inherit from <code class="language-plaintext highlighter-rouge">BaseClass</code> later.</p>

<p>My basic idea was to use a Template method like this.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;&gt;</span> <span class="nf">CreateDictionary</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">while</span><span class="p">(</span><span class="n">someConditionOnParameters</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">T</span> <span class="k">is</span> <span class="n">BaseClass</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Base class object creation code</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">T</span> <span class="k">is</span> <span class="n">DerivedClass</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Derived class object creation code</span>
        <span class="p">}</span>
        <span class="c1">// repeated dictionary creation code</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The other problem that I encounter here in was the arguments to this method. When we create the BaseClass object, I require fewer properties but when I created DerivedClass object, I require more properties and hence the number and type of arguments couldn’t be fixed. Of course, I can set/pass them as <code class="language-plaintext highlighter-rouge">null</code> and ignore when not needed, but that didn’t feel like a tidy solution to me. Plus later on, when we derive a new class from BaseClass, again the signature of method changes which might break a few things here and there.</p>

<p>That’s when I was suggested the interesting solution to this problem, the one I am going to share now. We keep one function that creates this dictionary but rather than passing the parameters to create the objects, we pass a function that creates those objects for us. For example when we want to create the BaseClass dictionary, we can pass a function that creates the base class object and so on. This way this method can be extensible for any classes that derive from future as well. Here is a dummy code to show how that method might look like</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">BaseClass</span><span class="p">&gt;</span> <span class="nf">CreateDictionary</span><span class="p">(</span><span class="n">DataObject</span> <span class="n">requiredData</span><span class="p">,</span> <span class="n">Func</span><span class="p">&lt;</span><span class="n">Data</span><span class="p">,</span> <span class="n">BaseClass</span><span class="p">&gt;</span> <span class="n">objectCreator</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">map</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">BaseClass</span><span class="p">&gt;();</span>
    <span class="k">foreach</span><span class="p">(</span><span class="n">Data</span> <span class="n">propertyValues</span> <span class="k">in</span> <span class="n">requiredData</span><span class="p">.</span><span class="n">data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">element</span> <span class="p">=</span> <span class="nf">objectCreator</span><span class="p">(</span><span class="n">Data</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">dependency</span> <span class="k">in</span> <span class="n">requiredData</span><span class="p">.</span><span class="n">dependencies</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">map</span><span class="p">[</span><span class="n">dependency</span><span class="p">.</span><span class="n">To</span><span class="p">]</span> <span class="p">=</span> <span class="n">dependency</span><span class="p">.</span><span class="n">From</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now when I want to create the base class dictionary, I can call it like:</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">map</span> <span class="p">=</span> <span class="nf">CreateDictionary</span><span class="p">(</span><span class="n">requiredData</span><span class="p">,</span> <span class="n">x</span> <span class="p">=&gt;</span> 
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">BaseClass</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">somePropertyValue</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Or if I want the derived class dictionary, like this:</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">map</span> <span class="p">=</span> <span class="nf">CreateDictionary</span><span class="p">(</span><span class="n">requiredData</span><span class="p">,</span> <span class="n">x</span> <span class="p">=&gt;</span> 
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">DerivedClass</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">SomePropertyValue</span><span class="p">,</span> <span class="n">someOtherPropertyValue</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p>I really loved this solution, its nifty and useful and this didnt come to my mind easily.</p>

<h3 id="closing-thoughts">Closing Thoughts</h3>

<p>I know this is a really specific and weird problem to encounter, and some constraints of why this solution was used over other ways are not clear from the vague names and class designs (and possibly incomplete details) I provided. However, I really found the solution interesting and felt like sharing it.</p>

<p>You can always share your thoughts on this by @’ing me on Twitter or LinkedIn (links are available in my author bio) or even this blog’s <a href="http://github.com/mitesh1612/blog">GitHub repo</a>.</p>

  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="mitesh1612/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/c%23/dictionaries/objects/2020/08/13/constructing-objects.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Mitesh Shah&#39;s Developer Blog, made using Fastpages</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/mitesh1612" title="mitesh1612"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/mitesh_1612" title="mitesh_1612"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
